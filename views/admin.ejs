<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - Respect Ledger</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
    body { font-family: 'Inter', sans-serif; }
  </style>
</head>
<body class="bg-slate-900 text-white min-h-screen pb-24">
  <div class="max-w-2xl mx-auto px-4 py-6">
    <!-- Header -->
    <div class="mb-6">
      <h1 class="text-2xl font-bold text-white flex items-center gap-2">
        <span>‚öôÔ∏è</span> Admin Panel
      </h1>
      <p class="text-slate-400 text-sm">Manage shop items, quests, and users</p>
    </div>

    <!-- Notifications Alert -->
    <% if (typeof notifications !== 'undefined' && notifications.length > 0) { %>
    <div class="bg-blue-900/30 border border-blue-600/50 rounded-xl p-4 mb-6">
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold">
            üîî
          </div>
          <div>
            <h2 class="font-bold text-blue-400">Shop Purchase Notifications</h2>
            <p class="text-sm text-blue-200/70"><%= notifications.length %> unread notification<%= notifications.length !== 1 ? 's' : '' %></p>
          </div>
        </div>
        <form action="/admin/notifications/read-all" method="POST">
          <button type="submit" class="px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white text-sm font-medium rounded-lg transition-colors">
            Mark All Read
          </button>
        </form>
      </div>
      
      <div class="space-y-2">
        <% notifications.forEach(notif => { %>
        <div class="bg-slate-800 border border-slate-700 rounded-lg p-3 flex items-center gap-3">
          <div class="text-2xl">üõí</div>
          <div class="flex-1">
            <p class="text-white text-sm"><%= notif.message %></p>
            <p class="text-slate-400 text-xs mt-1">
              <%= new Date(notif.created_at).toLocaleString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %>
            </p>
          </div>
          <form action="/admin/notifications/read/<%= notif.id %>" method="POST">
            <button type="submit" class="p-1.5 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors" title="Mark as read">
              <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
            </button>
          </form>
        </div>
        <% }); %>
      </div>
    </div>
    <% } %>

    <!-- Pending Purchases Alert -->
    <% if (typeof pendingPurchases !== 'undefined' && pendingPurchases.length > 0) { %>
    <div class="bg-blue-900/30 border border-blue-600/50 rounded-xl p-4 mb-6">
      <div class="flex items-center gap-3 mb-3">
        <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold">
          <%= pendingPurchases.length %>
        </div>
        <div>
          <h2 class="font-bold text-blue-400">Pending Shop Purchases</h2>
          <p class="text-sm text-blue-200/70">Review and mark purchases as bought</p>
        </div>
      </div>
      
      <div class="space-y-3">
        <% pendingPurchases.forEach(purchase => { %>
        <div class="bg-slate-800 border border-slate-700 rounded-lg p-4">
          <div class="flex items-center gap-4">
            <!-- Item Image -->
            <div class="w-16 h-16 rounded-lg bg-slate-700 overflow-hidden flex-shrink-0">
              <% if (purchase.item_image) { %>
                <img src="<%= purchase.item_image %>" alt="<%= purchase.item_name %>" class="w-full h-full object-cover">
              <% } else { %>
                <div class="w-full h-full flex items-center justify-center text-2xl">üéÅ</div>
              <% } %>
            </div>
            
            <!-- Purchase Info -->
            <div class="flex-1">
              <div class="flex items-center gap-2 mb-1">
                <span class="text-xl"><%= purchase.user_emoji %></span>
                <span class="font-medium text-white"><%= purchase.user_name %></span>
                <span class="text-slate-400 text-sm">wants to buy</span>
              </div>
              <p class="text-white font-medium"><%= purchase.item_name %></p>
              <p class="text-yellow-400 text-sm">ü•ö <%= purchase.item_price %></p>
            </div>
            
            <!-- Actions -->
            <div class="flex gap-2">
              <form action="/admin/purchases/approve/<%= purchase.id %>" method="POST">
                <button type="submit" class="px-4 py-2 bg-green-600 hover:bg-green-500 text-white font-medium rounded-lg transition-colors flex items-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                  </svg>
                  Mark as Bought
                </button>
              </form>
              <form action="/admin/purchases/reject/<%= purchase.id %>" method="POST">
                <button type="submit" class="px-4 py-2 bg-red-600 hover:bg-red-500 text-white font-medium rounded-lg transition-colors flex items-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                  </svg>
                  Reject
                </button>
              </form>
            </div>
          </div>
        </div>
        <% }); %>
      </div>
    </div>
    <% } %>

    <!-- Pending Approvals Alert -->
    <% if (pendingCompletions.length > 0) { %>
    <div class="bg-yellow-900/30 border border-yellow-600/50 rounded-xl p-4 mb-6">
      <div class="flex items-center gap-3 mb-3">
        <div class="w-10 h-10 bg-yellow-500 rounded-full flex items-center justify-center text-slate-900 font-bold">
          <%= pendingCompletions.length %>
        </div>
        <div>
          <h2 class="font-bold text-yellow-400">Pending Quest Approvals</h2>
          <p class="text-sm text-yellow-200/70">Review and approve completed quests</p>
        </div>
      </div>
      
      <div class="space-y-3">
        <% pendingCompletions.forEach(completion => { %>
        <div class="bg-slate-800 border border-slate-700 rounded-lg p-4">
          <div class="flex items-center gap-4">
            <!-- User Info -->
            <div class="flex items-center gap-2">
              <span class="text-2xl"><%= completion.user_emoji %></span>
              <span class="font-medium text-white"><%= completion.user_name %></span>
            </div>
            
            <!-- Quest Info -->
            <div class="flex-1">
              <p class="text-slate-400 text-sm">completed</p>
              <p class="text-white font-medium"><%= completion.quest_title %></p>
              <p class="text-purple-400 text-sm">+<%= completion.quest_reward %> ü•ö</p>
            </div>
            
            <!-- Actions -->
            <div class="flex gap-2">
              <form action="/admin/quests/approve/<%= completion.id %>" method="POST">
                <button type="submit" class="px-4 py-2 bg-green-600 hover:bg-green-500 text-white font-medium rounded-lg transition-colors flex items-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                  </svg>
                  Approve
                </button>
              </form>
              <form action="/admin/quests/reject/<%= completion.id %>" method="POST">
                <button type="submit" class="px-4 py-2 bg-red-600 hover:bg-red-500 text-white font-medium rounded-lg transition-colors flex items-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                  </svg>
                  Reject
                </button>
              </form>
            </div>
          </div>
        </div>
        <% }); %>
      </div>
    </div>
    <% } %>

    <!-- Tabs -->
    <div class="flex gap-2 mb-6 overflow-x-auto">
      <button onclick="showTab('items')" id="tab-items" class="tab-btn px-4 py-2 bg-yellow-500 text-slate-900 font-semibold rounded-lg whitespace-nowrap">
        Shop Items
      </button>
      <button onclick="showTab('quests')" id="tab-quests" class="tab-btn px-4 py-2 bg-slate-700 text-white font-semibold rounded-lg whitespace-nowrap">
        Quests
      </button>
      <button onclick="showTab('users')" id="tab-users" class="tab-btn px-4 py-2 bg-slate-700 text-white font-semibold rounded-lg whitespace-nowrap">
        Users
      </button>
    </div>

    <!-- ==================== SHOP ITEMS TAB ==================== -->
    <div id="panel-items" class="tab-panel">
      <!-- Add Item Form -->
      <div class="bg-slate-800 border border-slate-700 rounded-xl p-6 mb-6">
        <h2 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
          <span>‚ûï</span> Add New Item
        </h2>
        <form action="/admin/items" method="POST" enctype="multipart/form-data" class="space-y-4">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">Item Name</label>
              <input 
                type="text" 
                name="name" 
                required
                placeholder="Dragon Sword"
                class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white
                       focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent
                       placeholder:text-slate-500"
              >
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">Price (ü•ö)</label>
              <input 
                type="number" 
                name="price" 
                required
                min="1"
                placeholder="50"
                class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white
                       focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent
                       placeholder:text-slate-500"
              >
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-slate-300 mb-2">Item Image</label>
            <input 
              type="file" 
              name="image" 
              accept="image/*"
              class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white
                     file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0
                     file:text-sm file:font-semibold file:bg-yellow-500 file:text-slate-900
                     hover:file:bg-yellow-400 cursor-pointer"
            >
          </div>
          
          <button 
            type="submit"
            class="w-full py-3 bg-gradient-to-r from-yellow-500 to-yellow-600 text-slate-900 font-bold rounded-xl
                   hover:from-yellow-400 hover:to-yellow-500 transition-all"
          >
            Add Item
          </button>
        </form>
      </div>

      <!-- Items List -->
      <div class="bg-slate-800 border border-slate-700 rounded-xl overflow-hidden">
        <div class="p-4 border-b border-slate-700">
          <h2 class="text-lg font-bold text-white">Current Items (<%= items.length %>)</h2>
        </div>
        
        <% if (items.length === 0) { %>
        <div class="p-8 text-center text-slate-400">
          No items yet. Add your first item above!
        </div>
        <% } else { %>
        <div class="divide-y divide-slate-700">
          <% items.forEach(item => { %>
          <div class="p-4 flex items-center gap-4">
            <!-- Image -->
            <div class="w-16 h-16 rounded-lg bg-slate-700 overflow-hidden flex-shrink-0">
              <% if (item.image_url) { %>
                <img src="<%= item.image_url %>" alt="<%= item.name %>" class="w-full h-full object-cover">
              <% } else { %>
                <div class="w-full h-full flex items-center justify-center text-2xl">üéÅ</div>
              <% } %>
            </div>
            
            <!-- Details -->
            <div class="flex-1">
              <h3 class="font-semibold text-white"><%= item.name %></h3>
              <p class="text-yellow-400 font-medium">ü•ö <%= item.price %></p>
            </div>
            
            <!-- Delete Button -->
            <form action="/admin/items/delete/<%= item.id %>" method="POST" onsubmit="return confirm('Delete this item?')">
              <button type="submit" class="p-2 bg-red-600 hover:bg-red-500 rounded-lg transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                </svg>
              </button>
            </form>
          </div>
          <% }); %>
        </div>
        <% } %>
      </div>
    </div>

    <!-- ==================== QUESTS TAB ==================== -->
    <div id="panel-quests" class="tab-panel hidden">
      <!-- Add Quest Form -->
      <div class="bg-slate-800 border border-slate-700 rounded-xl p-6 mb-6">
        <h2 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
          <span>‚öîÔ∏è</span> Add New Quest
        </h2>
        <form action="/admin/quests" method="POST" class="space-y-4">
          <div class="grid grid-cols-2 gap-4">
            <div class="col-span-2 sm:col-span-1">
              <label class="block text-sm font-medium text-slate-300 mb-2">Quest Title</label>
              <input 
                type="text" 
                name="title" 
                required
                placeholder="Clean your room"
                class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white
                       focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent
                       placeholder:text-slate-500"
              >
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label class="block text-sm font-medium text-slate-300 mb-2">Reward (ü•ö)</label>
              <input 
                type="number" 
                name="reward" 
                required
                min="1"
                placeholder="10"
                class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white
                       focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent
                       placeholder:text-slate-500"
              >
            </div>
          </div>
          
          <button 
            type="submit"
            class="w-full py-3 bg-gradient-to-r from-purple-600 to-purple-700 text-white font-bold rounded-xl
                   hover:from-purple-500 hover:to-purple-600 transition-all"
          >
            Add Quest
          </button>
        </form>
      </div>

      <!-- Quests List -->
      <div class="bg-slate-800 border border-slate-700 rounded-xl overflow-hidden">
        <div class="p-4 border-b border-slate-700">
          <h2 class="text-lg font-bold text-white">All Quests (<%= quests.length %>)</h2>
        </div>
        
        <% if (quests.length === 0) { %>
        <div class="p-8 text-center text-slate-400">
          No quests yet. Create your first quest above!
        </div>
        <% } else { %>
        <div class="divide-y divide-slate-700">
          <% quests.forEach(quest => { %>
          <div class="p-4 flex items-center gap-4">
            <!-- Status Indicator -->
            <div class="w-3 h-3 rounded-full flex-shrink-0 <%= quest.is_active ? 'bg-green-500' : 'bg-slate-500' %>"></div>
            
            <!-- Details -->
            <div class="flex-1">
              <h3 class="font-semibold text-white <%= !quest.is_active ? 'line-through text-slate-400' : '' %>">
                <%= quest.title %>
              </h3>
              <p class="text-purple-400 font-medium">+<%= quest.reward %> ü•ö</p>
            </div>
            
            <!-- Actions -->
            <div class="flex gap-2">
              <form action="/admin/quests/toggle/<%= quest.id %>" method="POST">
                <button type="submit" class="p-2 <%= quest.is_active ? 'bg-yellow-600 hover:bg-yellow-500' : 'bg-green-600 hover:bg-green-500' %> rounded-lg transition-colors" title="<%= quest.is_active ? 'Deactivate' : 'Activate' %>">
                  <% if (quest.is_active) { %>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                  <% } else { %>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                  <% } %>
                </button>
              </form>
              
              <form action="/admin/quests/delete/<%= quest.id %>" method="POST" onsubmit="return confirm('Delete this quest?')">
                <button type="submit" class="p-2 bg-red-600 hover:bg-red-500 rounded-lg transition-colors">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                </button>
              </form>
            </div>
          </div>
          <% }); %>
        </div>
        <% } %>
      </div>
    </div>

    <!-- ==================== USERS TAB ==================== -->
    <div id="panel-users" class="tab-panel hidden">
      <!-- Add User Form -->
      <div class="bg-slate-800 border border-slate-700 rounded-xl p-6 mb-6">
        <h2 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
          <span>üë§</span> Add New User
        </h2>
        <form action="/admin/users" method="POST" class="space-y-4">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">Name</label>
              <input 
                type="text" 
                name="name" 
                required
                placeholder="John"
                class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white
                       focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent
                       placeholder:text-slate-500"
              >
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">PIN Code</label>
              <input 
                type="text" 
                name="pin_code" 
                required
                maxlength="10"
                placeholder="1234"
                class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white
                       focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent
                       placeholder:text-slate-500"
              >
            </div>
          </div>
          
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">Avatar Emoji</label>
              <input 
                type="text" 
                name="avatar_emoji" 
                placeholder="üòÄ"
                maxlength="4"
                class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white text-center text-2xl
                       focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent
                       placeholder:text-slate-500"
              >
            </div>
            <div class="flex items-end">
              <label class="flex items-center gap-3 cursor-pointer bg-slate-700 px-4 py-3 rounded-xl w-full">
                <input type="checkbox" name="is_admin" value="1" class="w-5 h-5 rounded border-slate-500 text-blue-500 focus:ring-blue-500">
                <span class="text-white font-medium">Admin?</span>
              </label>
            </div>
          </div>
          
          <button 
            type="submit"
            class="w-full py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white font-bold rounded-xl
                   hover:from-blue-500 hover:to-blue-600 transition-all"
          >
            Add User
          </button>
        </form>
      </div>

      <!-- Users List -->
      <div class="bg-slate-800 border border-slate-700 rounded-xl overflow-hidden">
        <div class="p-4 border-b border-slate-700">
          <h2 class="text-lg font-bold text-white">All Users (<%= users.length %>)</h2>
        </div>
        
        <div class="divide-y divide-slate-700">
          <% users.forEach(u => { %>
          <div class="p-4 flex items-center gap-4">
            <!-- Avatar -->
            <div class="text-3xl"><%= u.avatar_emoji %></div>
            
            <!-- Details -->
            <div class="flex-1">
              <h3 class="font-semibold text-white flex items-center gap-2">
                <%= u.name %>
                <% if (u.is_admin) { %>
                  <span class="text-xs bg-purple-600 px-2 py-0.5 rounded-full">Admin</span>
                <% } %>
              </h3>
              <p class="text-slate-400 text-sm">PIN: <%= u.pin_code %> ‚Ä¢ Balance: ü•ö <%= u.balance %></p>
            </div>
          </div>
          <% }); %>
        </div>
      </div>
    </div>
  </div>

  <!-- Fixed Bottom Navigation -->
  <nav class="fixed bottom-0 left-0 right-0 bg-slate-800 border-t border-slate-700 z-40">
    <div class="max-w-lg mx-auto px-4">
      <div class="flex justify-around items-center h-16">
        <a href="/" class="flex flex-col items-center gap-1 text-slate-400 hover:text-white transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
          </svg>
          <span class="text-xs font-medium">Home</span>
        </a>
        
        <a href="/quests" class="flex flex-col items-center gap-1 text-slate-400 hover:text-white transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
          </svg>
          <span class="text-xs font-medium">Quests</span>
        </a>
        
        <a href="/shop" class="flex flex-col items-center gap-1 text-slate-400 hover:text-white transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
          </svg>
          <span class="text-xs font-medium">Shop</span>
        </a>
        
        <a href="/admin" class="flex flex-col items-center gap-1 text-white relative">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>
          <span class="text-xs font-medium">Admin</span>
          <% 
            const totalBadgeCount = (typeof pendingCount !== 'undefined' ? pendingCount : 0) + 
                                    (typeof notificationCount !== 'undefined' ? notificationCount : 0);
          %>
          <% if (totalBadgeCount > 0) { %>
          <span class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center">
            <%= totalBadgeCount %>
          </span>
          <% } %>
        </a>
        
        <a href="/logout" class="flex flex-col items-center gap-1 text-slate-400 hover:text-red-400 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
          </svg>
          <span class="text-xs font-medium">Logout</span>
        </a>
      </div>
    </div>
  </nav>

  <!-- Flash Messages -->
  <% if (flash) { %>
  <div id="flash-message" class="fixed top-4 right-4 z-50 max-w-sm">
    <div class="<%= flash.type === 'error' ? 'bg-red-500' : 'bg-green-500' %> text-white px-6 py-4 rounded-lg shadow-xl flex items-center gap-3">
      <% if (flash.type === 'error') { %>
        <svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      <% } else { %>
        <svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      <% } %>
      <span class="font-medium"><%= flash.message %></span>
    </div>
  </div>
  <script>
    setTimeout(() => {
      const flash = document.getElementById('flash-message');
      if (flash) {
        flash.style.transition = 'opacity 0.5s';
        flash.style.opacity = '0';
        setTimeout(() => flash.remove(), 500);
      }
    }, 3000);
  </script>
  <% } %>

  <script>
    function showTab(tabName) {
      // Hide all panels
      document.querySelectorAll('.tab-panel').forEach(panel => {
        panel.classList.add('hidden');
      });
      
      // Reset all tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('bg-yellow-500', 'text-slate-900');
        btn.classList.add('bg-slate-700', 'text-white');
      });
      
      // Show selected panel
      document.getElementById('panel-' + tabName).classList.remove('hidden');
      
      // Highlight selected tab
      const activeBtn = document.getElementById('tab-' + tabName);
      activeBtn.classList.remove('bg-slate-700', 'text-white');
      activeBtn.classList.add('bg-yellow-500', 'text-slate-900');
    }
  </script>
</body>
</html>
